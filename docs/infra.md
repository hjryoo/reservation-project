# 콘서트 예약 서비스 인프라 구성도
***

## 시스템 구성 개요

```
┌────────────────────────────────┐
│           Internet             │
└────────────────────────────────┘
              │
┌────────────────────────────────┐
│    CDN (CloudFlare)            │
│    * 정적 파일 캐싱               │
│    * DDoS 방어                  │
└────────────────────────────────┘
              │
┌────────────────────────────────┐
│  Load Balancer (ALB)           │
│  * SSL 종료/헬스체크               │
│  * 인스턴스 트래픽 분산             │
└────────────────────────────────┘
              │
┌─────────────────────────────────────────────┐
│        Application Servers (Auto Scaling)   │
│  * Spring Boot/Java                         │
│  * API Gateway/RESTful                      │
│  * JWT 인증                                  │
│  * 단위테스트 작성(Controller/Service 분리)      │
│  * 다수 인스턴스 (Stateless 구성)                │
│  * 대기열 로직 구현                             │
└─────────────────────────────────────────────┘
              │
┌─────────────────────────────────────────────┐
│      Redis (분산 캐시)                        │
│  * 대기열 관리 (Sorted Set/TTL)                │
│  * 임시 좌석 배정                               │
│  * 세션 데이터                                  │
│  * 동시성 고려 (Atomic 연산/분산락)               │
└─────────────────────────────────────────────┘
              │
┌─────────────────────────────────────────────┐
│         MySQL (Primary + Replica)           │
│  * 사용자, 예약, 결제, 좌석 등 저장            │
│  * 트랜잭션/락 기반 동시성 방어                    │
│  * 중복예약·결제 테스트케이스                │
│  * 좌석/잔액 관련 단위테스트 필수                   │
└─────────────────────────────────────────────┘
              │
┌─────────────────────────────────────────────┐
│         Monitoring / Logging                │
│  * API/DB 에러율, 트래픽 등 단위 관측       │
└─────────────────────────────────────────────┘
```

***
- **단위 테스트** : 모든 API 기능(예: 좌석 예약, 잔액 충전, 대기열 순서 검증 등)을 Controller/Service/Repository 레이어별로 테스트 케이스 도출이 용이하도록 구조화. (예: 이미 예약된 좌석에 대한 Conflict 응답, 대기열 순서 미도달 시 Forbidden 테스트)
- **다중 인스턴스 환경** : Stateless 서버 운영/Auto Scaling, Redis/DB 락을 통해 어떤 인스턴스에서든 동일 기능 보장.
- **동시성 이슈 방어** : Redis 분산락(Pub/Sub, Atomic), MySQL 트랜잭션 및 락(ROW LOCK/UNIQUE)으로 race condition 방지.
- **대기열 시스템** : 사용자 요청 순서 보장(Sorted Set), 대기열 토큰 상태/만료 관리(TTL + 테스트 가능), 활성 유저 수 제한 및 동적 관리.

***
